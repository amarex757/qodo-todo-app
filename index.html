<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>To‑Do List</title>
  <style>
    :root {
      --bg: #0f172a;        /* slate-900 */
      --panel: #111827;     /* gray-900 */
      --muted: #94a3b8;     /* slate-400 */
      --text: #e2e8f0;      /* slate-200 */
      --accent: #22c55e;    /* green-500 */
      --danger: #ef4444;    /* red-500 */
      --border: #1f2937;    /* gray-800 */
      --btn: #1f2937;       /* gray-800 */
      --btn-hover: #374151; /* gray-700 */
      --link: #60a5fa;      /* blue-400 */
    }

    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% -10%, #1e293b 0, transparent 60%),
                  radial-gradient(1000px 600px at 120% 10%, #0b4d2b33 0, transparent 60%),
                  var(--bg);
      color: var(--text);
    }

    .app {
      max-width: 720px;
      margin: 48px auto;
      padding: 24px;
      background: linear-gradient(180deg, #0b4d2b14, transparent 60%), var(--panel);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }

    h1 {
      margin: 0 0 24px 0;
      font-weight: 800;
      letter-spacing: -0.02em;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: clamp(24px, 3vw, 32px);
    }
    h1 .logo {
      display: inline-grid;
      place-items: center;
      width: 36px; height: 36px;
      border-radius: 9px;
      background: radial-gradient(150% 150% at 30% 20%, #34d399 0, #10b981 35%, #065f46 100%);
      box-shadow: 0 4px 14px #22c55e55 inset, 0 4px 18px #22c55e33;
      color: white;
      font-weight: 700;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr auto auto;
      gap: 12px;
    }

    input[type="text"] {
      width: 100%;
      background: #0b1220;
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px 14px;
      font-size: 16px;
      outline: none;
      box-shadow: 0 1px 0 rgba(255,255,255,0.02) inset;
    }
    input[type="text"]::placeholder { color: #64748b; }
    input[type="text"]:focus { border-color: #0ea5e9; box-shadow: 0 0 0 3px #0ea5e933; }

    button {
      background: var(--btn);
      color: var(--text);
      border: 1px solid var(--border);
      padding: 10px 14px;
      font-size: 14px;
      border-radius: 10px;
      cursor: pointer;
      transition: background .15s ease;
    }
    button:hover { background: var(--btn-hover); }
    .btn-primary { background: #15803d; border-color: #166534; }
    .btn-primary:hover { background: #16a34a; }

    /* Priority select, due date, and badges */
    select, input[type="date"] {
      background: var(--btn);
      color: var(--text);
      border: 1px solid var(--border);
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 14px;
    }
    select:focus, input[type="date"]:focus { outline: none; border-color: #0ea5e9; box-shadow: 0 0 0 3px #0ea5e933; }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
      line-height: 1.4;
      border: 1px solid var(--border);
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
    }
    .badge.p-low { background: #102a1f; color: #bbf7d0; border-color: #14532d; }
    .badge.p-medium { background: #3a2a0d; color: #fed7aa; border-color: #7c2d12; }
    .badge.p-high { background: #2a1313; color: #fecaca; border-color: #7f1d1d; }
    .badge.due { background: #0b2a3a; color: #bae6fd; border-color: #075985; cursor: default; }
    .text .badge { margin-left: 8px; }

    .toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin: 18px 0 10px;
      flex-wrap: wrap;
    }

    .filters { display: inline-flex; gap: 6px; }
    .filters button { padding: 8px 10px; font-size: 13px; }
    .filters .active { outline: 2px solid #22c55eaa; }

    .meta { color: var(--muted); font-size: 13px; }

    ul.todos {
      list-style: none;
      padding: 0;
      margin: 12px 0 0 0;
      display: grid;
      gap: 8px;
    }

    .todo-item {
      display: grid;
      grid-template-columns: auto auto 1fr auto auto;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      background: #0b1220;
      border: 1px solid var(--border);
      border-radius: 10px;
    }
    .todo-item .text { user-select: text; }
    .todo-item.completed .text { text-decoration: line-through; color: #64748b; }

    .todo-item .text { white-space: pre-wrap; }

    .todo-item .danger { color: #fecaca; border-color: #7f1d1d; background: #1f1010; }
    .todo-item .danger:hover { background: #2a1313; }

    .empty { text-align: center; color: var(--muted); padding: 24px 8px; border: 1px dashed var(--border); border-radius: 10px; }

    .sr-only {
      position: absolute !important;
      height: 1px; width: 1px;
      overflow: hidden; clip: rect(1px, 1px, 1px, 1px);
      white-space: nowrap; border: 0; padding: 0; margin: -1px;
    }
  </style>
</head>
<body>
  <main class="app" role="application" aria-labelledby="app-title">
    <h1 id="app-title"><span class="logo" aria-hidden="true">✓</span> To‑Do List</h1>

    <form id="add-form" class="row" autocomplete="off" aria-label="Add a new task">
      <label class="sr-only" for="new-todo">New to‑do</label>
      <input id="new-todo" name="new-todo" type="text" placeholder="What needs to be done?" />
      <label class="sr-only" for="new-priority">Priority</label>
      <select id="new-priority" aria-label="Priority">
        <option value="high">High</option>
        <option value="medium" selected>Medium</option>
        <option value="low">Low</option>
      </select>
      <label class="sr-only" for="new-due">Due date</label>
      <input id="new-due" type="date" aria-label="Due date" />
      <button class="btn-primary" type="submit" aria-label="Add">Add</button>
    </form>

    <div class="toolbar">
      <div class="filters" role="tablist" aria-label="Filter tasks">
        <button type="button" data-filter="all" class="active" role="tab" aria-selected="true">All</button>
        <button type="button" data-filter="active" role="tab" aria-selected="false">Active</button>
        <button type="button" data-filter="completed" role="tab" aria-selected="false">Completed</button>
      </div>
      <div class="actions" style="display:flex; gap:8px; align-items:center;">
        <label class="sr-only" for="sort">Sort</label>
        <select id="sort" title="Sort order" aria-label="Sort">
          <option value="added">Sort: Added</option>
          <option value="due">Sort: Due date (Soonest→Latest)</option>
          <option value="priority">Sort: Priority (High→Low)</option>
        </select>
        <button id="clear-completed" type="button" title="Clear completed tasks">Clear completed</button>
      </div>
    </div>

    <div class="meta" aria-live="polite" aria-atomic="true">
      <span id="count">0</span> item(s) left
    </div>

    <ul id="list" class="todos" aria-live="polite" aria-atomic="false"></ul>

    <div id="empty" class="empty" hidden>No tasks yet. Add your first one above.</div>

    <div id="live" class="sr-only" aria-live="polite" aria-atomic="true"></div>
  </main>

  <script>
    (function() {
      const STORAGE_KEY = 'todos-v1';
      const $ = (sel, ctx=document) => ctx.querySelector(sel);
      const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));

      const el = {
        form: $('#add-form'),
        input: $('#new-todo'),
        list: $('#list'),
        count: $('#count'),
        empty: $('#empty'),
        filters: $('.filters'),
        clearCompleted: $('#clear-completed'),
        live: $('#live'),
        priority: $('#new-priority'),
        due: $('#new-due'),
        sort: $('#sort')
      };

      let state = {
        todos: [],
        filter: 'all', // 'all' | 'active' | 'completed'
        sort: 'added' // 'added' | 'priority' | 'due'
      };

      function uid() {
        return Date.now().toString(36) + Math.random().toString(36).slice(2,7);
      }

      function load() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return;
          const data = JSON.parse(raw);
          if (Array.isArray(data.todos)) {
            state.todos = data.todos.map(t => ({
              id: t.id || uid(),
              text: String(t.text || ''),
              completed: !!t.completed,
              priority: (t.priority === 'high' || t.priority === 'low') ? t.priority : 'medium',
              createdAt: typeof t.createdAt === 'number' ? t.createdAt : Date.now(),
              due: (typeof t.due === 'string' && t.due) ? t.due : null
            }));
          }
          if (data.filter === 'active' || data.filter === 'completed' || data.filter === 'all') {
            state.filter = data.filter;
          }
          if (data.sort === 'priority' || data.sort === 'added' || data.sort === 'due') {
            state.sort = data.sort;
          }
        } catch (e) { /* ignore corrupt storage */ }
      }

      function save() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify({ todos: state.todos, filter: state.filter, sort: state.sort }));
      }

      function setFilter(filter) {
        state.filter = filter;
        save();
        render();
      }

      function addTodo(text, priority, dueStr) {
        text = text.trim();
        if (!text) return;
        const p = (priority === 'high' || priority === 'low' || priority === 'medium') ? priority : 'medium';
        const due = (typeof dueStr === 'string' && /^\d{4}-\d{2}-\d{2}$/.test(dueStr)) ? dueStr : null;
        state.todos.unshift({ id: uid(), text, completed: false, priority: p, createdAt: Date.now(), due });
        save();
        announce(`Added: ${text} [${p}]${due ? ' (Due ' + due + ')' : ''}`);
        render();
      }

      function toggleTodo(id) {
        const t = state.todos.find(t => t.id === id);
        if (!t) return;
        t.completed = !t.completed;
        save();
        announce(`${t.completed ? 'Completed' : 'Reopened'}: ${t.text}`);
        render();
      }

      function cyclePriority(id) {
        const t = state.todos.find(t => t.id === id);
        if (!t) return;
        const order = ['low','medium','high'];
        const idx = order.indexOf(t.priority || 'medium');
        const next = order[(idx + 1) % order.length];
        t.priority = next;
        save();
        announce(`Priority updated: ${t.text} → ${next}`);
        render();
      }

      function deleteTodo(id) {
        const idx = state.todos.findIndex(t => t.id === id);
        if (idx === -1) return;
        const [removed] = state.todos.splice(idx, 1);
        save();
        announce(`Deleted: ${removed.text}`);
        render();
      }

      function editTodo(id) {
        const t = state.todos.find(t => t.id === id);
        if (!t) return;
        const next = prompt('Edit to‑do:', t.text);
        if (next == null) return; // cancel
        const text = next.trim();
        if (!text) return; // ignore empty edits
        t.text = text;
        save();
        announce(`Edited: ${text}`);
        render();
      }

      function clearCompleted() {
        const before = state.todos.length;
        state.todos = state.todos.filter(t => !t.completed);
        if (state.todos.length !== before) {
          save();
          announce('Cleared completed tasks');
          render();
        }
      }

      function filteredTodos() {
        let arr;
        switch (state.filter) {
          case 'active': arr = state.todos.filter(t => !t.completed); break;
          case 'completed': arr = state.todos.filter(t => t.completed); break;
          default: arr = state.todos.slice(); break;
        }
        if (state.sort === 'priority') {
          const weight = { low: 0, medium: 1, high: 2 };
          arr.sort((a,b) => (weight[b.priority || 'medium'] - weight[a.priority || 'medium']) || ((b.createdAt||0) - (a.createdAt||0)));
        } else if (state.sort === 'due') {
          const due = (t) => (typeof t.due === 'string' && t.due) ? Date.parse(t.due) : Infinity;
          arr.sort((a,b) => (due(a) - due(b)) || ((a.createdAt||0) - (b.createdAt||0)));
        }
        return arr;
      }

      function render() {
        const items = filteredTodos();
        el.list.innerHTML = '';
        for (const t of items) {
          const li = document.createElement('li');
          li.className = 'todo-item' + (t.completed ? ' completed' : '');
          li.dataset.id = t.id;

          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.checked = t.completed;
          checkbox.setAttribute('aria-label', 'Toggle complete');

          const badge = document.createElement('span');
          const p = t.priority || 'medium';
          badge.className = 'badge p-' + p;
          badge.textContent = p[0].toUpperCase() + p.slice(1);
          badge.title = 'Click to change priority';

          const text = document.createElement('div');
          text.className = 'text';
          text.textContent = t.text;
          if (t.due) {
            const dv = document.createElement('span');
            dv.className = 'badge due';
            dv.textContent = 'Due: ' + t.due;
            text.appendChild(dv);
          }

          const editBtn = document.createElement('button');
          editBtn.type = 'button';
          editBtn.textContent = 'Edit';

          const delBtn = document.createElement('button');
          delBtn.type = 'button';
          delBtn.textContent = 'Delete';
          delBtn.className = 'danger';

          li.append(checkbox, badge, text, editBtn, delBtn);
          el.list.appendChild(li);
        }

        const activeLeft = state.todos.filter(t => !t.completed).length;
        el.count.textContent = String(activeLeft);
        el.empty.hidden = state.todos.length !== 0;

        // filters UI
        $(".filters button").forEach(b => {
          b.classList.toggle('active', b.dataset.filter === state.filter);
          b.setAttribute('aria-selected', String(b.dataset.filter === state.filter));
        });
        if (el.sort) el.sort.value = state.sort;
      }

      function announce(msg) {
        el.live.textContent = msg;
      }

      // Event Listeners
      el.form.addEventListener('submit', (e) => {
        e.preventDefault();
        addTodo(el.input.value, el.priority ? el.priority.value : 'medium', el.due ? el.due.value : null);
        if (el.form) el.form.reset();
        el.input.focus();
      });

      el.filters.addEventListener('click', (e) => {
        const btn = e.target.closest('button[data-filter]');
        if (!btn) return;
        setFilter(btn.dataset.filter);
      });

      if (el.sort) {
        el.sort.addEventListener('change', (e) => {
          const v = (e.target.value === 'priority' || e.target.value === 'due') ? e.target.value : 'added';
          state.sort = v;
          save();
          render();
        });
      }

      el.clearCompleted.addEventListener('click', () => clearCompleted());

      el.list.addEventListener('click', (e) => {
        const li = e.target.closest('.todo-item');
        if (!li) return;
        const id = li.dataset.id;
        if (e.target.matches('input[type="checkbox"]')) {
          toggleTodo(id);
        } else if (e.target.matches('.badge.p-low, .badge.p-medium, .badge.p-high')) {
          cyclePriority(id);
        } else if (e.target.matches('button.danger')) {
          deleteTodo(id);
        } else if (e.target.matches('button')) {
          editTodo(id);
        }
      });

      // Keyboard: Enter on input adds; list interactions handled above

      // Init
      load();
      render();
    })();
  </script>
</body>
</html>